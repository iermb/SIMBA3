<?php

namespace SIMBA3\Component\Domain\Value\Service;

use InvalidArgumentException;
use PHPUnit\Framework\TestCase;
use SIMBA3\Component\Domain\Filter\Service\AreasFilter;
use SIMBA3\Component\Domain\Filter\Service\IndependentVariablesFilter;
use SIMBA3\Component\Domain\Filter\Service\YearsFilter;
use SIMBA3\Component\Domain\Filter\Service\MonthsFilter;
use SIMBA3\Component\Domain\Value\Repository\AreaYearValueRepository;
use SIMBA3\Component\Domain\Value\Repository\AreaMonthYearValueRepository;
use SIMBA3\Component\Domain\Value\Repository\AreaIndependentVariable1YearValueRepository;
use SIMBA3\Component\Domain\Value\Repository\AreaIndependentVariable2YearValueRepository;
use SIMBA3\Component\Domain\Value\Repository\YearValueRepository;

class FactoryTypeValueTest extends TestCase
{
    private FactoryTypeValue $factoryTypeValue;
    private AreaYearValueRepository $areaYearValueRepository;
    private AreaMonthYearValueRepository $areaMonthYearValueRepository;
    private AreaIndependentVariable1YearValueRepository $areaIndependentVariable1YearValueRepository;
    private AreaIndependentVariable2YearValueRepository $areaIndependentVariable2YearValueRepository;
    private YearValueRepository $yearValueRepository;
    private array $filters;
    private AreasFilter $areasFilter;
    private IndependentVariablesFilter $independentVariableFilter;
    private YearsFilter $yearsFilter;
    private MonthsFilter $monthsFilter;

    protected function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub

        $this->areaYearValueRepository = $this->createMock(AreaYearValueRepository::class);
        $this->areaMonthYearValueRepository = $this->createMock(AreaMonthYearValueRepository::class);
        $this->areaIndependentVariable1YearValueRepository = $this->createMock(AreaIndependentVariable1YearValueRepository::class);
        $this->areaIndependentVariable2YearValueRepository = $this->createMock(AreaIndependentVariable2YearValueRepository::class);
        $this->yearValueRepository = $this->createMock(YearValueRepository::class);

        $this->areasFilter = $this->createMock(AreasFilter::class);
        $this->independentVariableFilter = $this->createMock(IndependentVariablesFilter::class);
        $this->yearsFilter = $this->createMock(YearsFilter::class);
        $this->monthsFilter = $this->createMock(MonthsFilter::class);

        $this->filters = array(
            "areas" => [[1,2]],
            "independentVariable1s" => [[1,2]],
            "independentVariable2s" => [[1,2]],
            "years" => [2000],
            "months" => [4],
        );
    }

    /** @test */
    public function shouldFactoryTypeValueExpectsErrorWhenNotExistsTheType(): void
    {
        $this->givenAFactoryTypeValue();
        $this->thenExpectsInvalidArgumentException();
        $this->whenGetObjectTypeValueNotExists();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnAreaIndependentVariable2YearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsAreaIndependentVariable2YearValueThenReturnAreaIndependentVariable2YearTypeValue();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnAreaIndependentVariable1YearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsAreaIndependentVariable1YearValueThenReturnAreaIndependentVariable1YearTypeValue();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnAreaMonthYearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsAreaMonthYearValueThenReturnAreaMonthYearTypeValue();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnAreaTermYearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsAreaTermYearValueThenReturnAreaTermYearTypeValue();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnAreaYearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsAreaYearValueThenReturnAreaYearTypeValue();
    }

    /** @test */
    public function shouldFactoryTypeValueReturnYearTypeValue(): void
    {
        $this->givenAFactoryTypeValue();
        $this->whenGetObjectTypeValueIsYearValueThenReturnYearTypeValue();
    }

    private function givenAFactoryTypeValue(): void
    {
        $this->factoryTypeValue = new FactoryTypeValue(
            $this->areaYearValueRepository,
            $this->areaMonthYearValueRepository,
            $this->areaIndependentVariable1YearValueRepository,
            $this->areaIndependentVariable2YearValueRepository,
            $this->yearValueRepository
        );
    }

    private function thenExpectsInvalidArgumentException(): void
    {
        $this->expectException(InvalidArgumentException::class);
    }

    private function whenGetObjectTypeValueNotExists(): void
    {
        $this->factoryTypeValue->getObjectTypeValue("NOT EXISTS", 1001, $this->filters);
    }

    private function whenGetObjectTypeValueIsAreaIndependentVariable2YearValueThenReturnAreaIndependentVariable2YearTypeValue(): void
    {
        $this->assertInstanceOf(
            AreaIndependentVariable2YearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("AREA_INDEPENDENT_VARIABLE_2_YEAR_VALUE", 1001, $this->filters)
        );
    }

    private function whenGetObjectTypeValueIsAreaIndependentVariable1YearValueThenReturnAreaIndependentVariable1YearTypeValue(): void
    {
        $this->assertInstanceOf(
            AreaIndependentVariable1YearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("AREA_INDEPENDENT_VARIABLE_1_YEAR_VALUE", 1001, $this->filters)
        );
    }

    private function whenGetObjectTypeValueIsAreaMonthYearValueThenReturnAreaMonthYearTypeValue(): void
    {
        $this->assertInstanceOf(
            AreaMonthYearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("AREA_MONTH_YEAR_VALUE", 1001, $this->filters)
        );
    }

    private function whenGetObjectTypeValueIsAreaTermYearValueThenReturnAreaTermYearTypeValue(): void
    {
        $this->assertInstanceOf(
            AreaMonthYearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("AREA_TERM_YEAR_VALUE", 1001, $this->filters)
        );
    }

    private function whenGetObjectTypeValueIsAreaYearValueThenReturnAreaYearTypeValue(): void
    {
        $this->assertInstanceOf(
            AreaYearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("AREA_YEAR_VALUE", 1001, $this->filters)
        );
    }

    private function whenGetObjectTypeValueIsYearValueThenReturnYearTypeValue(): void
    {
        $this->assertInstanceOf(
            YearTypeValue::class,
            $this->factoryTypeValue->getObjectTypeValue("YEAR_VALUE", 1001, $this->filters)
        );
    }
}
